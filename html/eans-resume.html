<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="bower_components/core-scroll-header-panel/core-scroll-header-panel.html">
<link rel="import" href="bower_components/core-icons/core-icons.html">
<link rel="import" href="bower_components/core-icons/social-icons.html">
<link rel="import" href="bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="safe-html.html">
<link rel="import" href="document-grid.html">
<link rel="import" href="grid-hero-displayer.html">

<polymer-element name="eans-resume">

  <template>
    <style>
      #core_scroll_header_panel {
        top: 0;
        left: 0;
        height:100%;
        width:100%;
        position: absolute;
        background:#EEEEEE;
      }
      #eanImage{
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: block;
        background-image: url(ean.jpg);
        margin: 2px;
      }
      #eanImageWrapper{
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: block;
        background-color: white;
      }
      #core_toolbar {
        color: rgb(241, 241, 241);
        fill: rgb(241, 241, 241);
        background-color: rgb(66, 133, 244);
      }
      .sectionPage {
        display: block;
        background-color: #fff;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        border-radius: 2px;
        overflow: hidden;
        max-width:1200px;
        margin: 32px auto 32px auto;
        position:relative !important;
      }
      .sector {
        margin: 16px;
        padding: 8px;
      }
      .sectionHeader
      {
        font-size: xx-large;
        padding:16px 0px 0px 16px;
      }
      a
      {
        text-decoration: none;
      }
      .experienceName
      {
        font-size: large;
        font-weight:bold;
      }
      .experienceName
      {
        font-size: normal;
        font-weight: normal;
      }
      .experienceHeader
      {
        width: 100%;
        text-align: center;
      }
      .experienceContent
      {
        padding: 0px 8px 8px 8px;
      }
      #projectResumeInfo
      {
        padding:32px;
      }
      .refName
      {
        float: center;
        text-align: center;
      }
      .refText
      {
        max-width: 200px;
        padding: 8px;
      }
      #loadingWrapper{
        bottom: 0;
        height: 50px;
        left: 0;
        margin: auto;
        width:100%;
        position: absolute;
        top: 0;
        right: 0;
        text-align: center;
      }
      #loadingSection
      {
        height:100%;
        width:100%;
      }
      #primaryPages
      {
        height:100%;
        width:100%;
      }
      #fab
      {
        bottom:16px;
        right:24px;
        position:absolute;
        z-index:1;
        color: rgb(241, 241, 241);
        fill: rgb(241, 241, 241);
        background-color: rgb(66, 133, 244);
      }
      .aShareLink
      {
        width:100%;
        text-align:center;
      }
      .details
      {
        color:gray;
      }
      paper-progress::shadow #activeProgress {
        background-color: #4285F4;
      }
      .blue
      {
        color:blue;
      }
      .achievement
      {
        margin: 8px 20px 8px 20px;
        padding: 4px;
      }
      .printonly
      {
        display:none;
      }
      @media (max-width: 1200px) {
      .sectionPage {
        margin: auto;
        padding: 0px 0px 64px 0px;
      }
      #fab
      {
        bottom:8px;
        right:8px;
      }
      .sector {
        margin: 8px;
        padding:0px;
      }
      .sectionHeader
      {
        font-size: x-large;
        padding:8px;
      }
    }
    </style>
    <iframe id="printFrame" style="display:none"></iframe>
    <paper-dialog id="accessDialog" heading="Access Key" transition="paper-dialog-transition-bottom" autoCloseDisabled="true">
        <p>If you have been given an Access Key, please enter it below. Otherwise leave the field blank.</p>
        <paper-input style="width:100%;" label="Access Key" value="{{accessKeyHolder.accessKey}}"></paper-input>
        <p>Access keys allow you to see a version of the resume that is customized for your oganization. As well as private imformation like references and transcripts.</p>
        <paper-button id="accessKeyButton" on-tap="{{customize}}" affirmative>Ok</paper-button>
    </paper-dialog>
    <paper-fab id="fab" icon="mail" on-click="{{emailEan}}"></paper-fab>
    <paper-dialog id="shareDialog" heading="Share Ean's Resume" transition="paper-dialog-transition-bottom">
    <div class="aShareLink">
      <p>
     <p>Copy the link below and share this resume with whomever you like.</p>
     <div hidden?="{{accessKeyHolder.accessKey == 'nokey'}}">
       <paper-checkbox checked="{{sharePrivate}}" label="I am sharing this within my organization"></paper-checkbox>
     </div>
       <p>
        <a on-click={{copy}} class="blue" hidden?="{{sharePrivate}}" >http://eanlom.info/?a=nokey</a>
        <a on-click={{copy}} class="blue" hidden?="{{!sharePrivate}}">http://eanlom.info/?a={{accessKeyHolder.accessKey}}</a>
      </p>
    </div>
    <paper-button affirmative>Ok</paper-button>
    </paper-dialog>
    <core-scroll-header-panel id="core_scroll_header_panel">
      <core-toolbar id="core_toolbar" flex>
        <div hidden?="{{page > 1}}" id="eanImageWrapper"><div id="eanImage"></div></div>
        <div hidden?="{{page > 1}}" flex>Ean's Resume</div>
        <paper-icon-button hidden?="{{page != 2}}" icon="arrow-back" on-tap="{{backToResume}}"></paper-icon-button>
        <div hidden?="{{page < 2}}" flex>Project Resume</div>
        <paper-icon-button hidden?="{{page != 1}}" icon="print" on-tap="{{print}}"></paper-icon-button>
        <paper-icon-button hidden?="{{page != 1}}" icon="info" on-tap="{{showProjectResume}}"></paper-icon-button>
        <paper-icon-button icon="social:share" on-click="{{share}}"></paper-icon-button>
      </core-toolbar>
      <core-animated-pages id="primaryPages" selected="{{page}}" transitions="cross-fade-all" content>
      <section id="loadingSection">
        <div id="loadingWrapper">
          <div id="loadingTitle">{{customText}}</div>
          <paper-progress value="{{totalLoaded}}" max="{{maxLoad}}"></paper-progress>
        </div>
      </section>
      <section id="primarySection" class="sectionPage" vertical layout>

      <div class="printonly"><p>This document is up to date as of {{today}}. To see an always up to date version see<br><a href="http://eanlom.info/?a={{accessKeyHolder.accessKey}}">http://eanlom.info/?a={{accessKeyHolder.accessKey}}</a></p></div>
      <section id="introductionSection">
          <template repeat="{{i in introductions}}">
            <div class="sector" vertical layout><safe-html html="{{i.content}}"></safe-html></div>
          </template>
       </section>
        <section id="achievementSection">
          <div class="sectionHeader">Achievements</div>
          <template repeat="{{a in achievements}}">
            <div class="achievement" vertical layout>{{a.text}}</div>
          </template>
        </section>
        <section id="experienceSection">
          <div class="sectionHeader">Experience</div>
          <template id="template" repeat="{{e in experiences}}">
            <div class="sector" vertical layout>
              <div class="experienceHeader">
                <div><a class="experienceName" href="{{e.companyUrl}}">
                  {{e.companyName}}
                </a></div>
                {{e.workPeriod}}
              </div>
              <div class="experienceContent"><safe-html html="{{e.content}}"></safe-html></div>
            </div>
          </template>
        </section>
        <section id="referencesSection" hidden?="{{references == null || references.length == 0}}">
           <div class="sectionHeader">References</div>
           <div id="referencesContainer" horizontal layout wrap around-justified start>
             <template id="template" repeat="{{r in references}}">
                <div class="sector" vertical layout>
                  <div class="refName">{{r.name}}</div>
                  <div class="refPhone"><a href="tel:{r.phone}}">{{r.phone}}</a></div>
                  <div class="refEmail"><a href="tel:{r.email}}">{{r.email}}</a></div>
                  <div class="refText">{{r.text}}</div>
                </div>
              </template>
           </div>
        </section>
        <section id="documentSection" class="noprint" hidden?="{{documents == null || references.length == 0}}">
          <div class="sectionHeader">Documents</div>
          <document-grid id="documentsDisplayer" items="{{documents}}" ga="{{ga}}"></document-grid>
        </section>
        <section id="languageSection">
          <div class="sectionHeader">Languages <span class="details noprint"> (Click for More Details)</span></div>
          <grid-hero-displayer id="languageDisplayer" items="{{languages}}" ga="{{ga}}" class="noprint"></grid-hero-displayer>
          <div class="printonly sector">
            <template repeat="{{l in languages}}">
              <span style="padding-right:4em">{{l.name}}</span>
            </template>
          </div>
        </section>
        <section id="technologiesSection">
          <div class="sectionHeader">Technologies <span class="details noprint"> (Click for More Details)</span></div>
          <grid-hero-displayer id="technologiesDisplayers" items="{{technologies}}" ga="{{ga}}" class="noprint"></grid-hero-displayer>
          <div class="printonly sector">
            <template repeat="{{t in technologies}}">
              <span style="padding-right:4em">{{t.name}}</span>
            </template>
          </div>
        </section>
        <section id="projectsSection">
        <div class="sectionHeader">My Projects</div>
          <template id="projectsTemplate" repeat="{{p in projects}}">
            <div class="sector" vertical layout>
              <div class="experienceHeader">
                <div><a class="experienceName" href="{{p.repoUrl}}">
                  {{p.name}}
                </a></div>
                {{p.technologies}}
              </div>
              <div class="experienceContent"><safe-html html="{{p.content}}"></safe-html></div>
            </div>
          </template>
          <div class="sector" vertical layout>
              <div class="experienceHeader">
                <div><a class="experienceName" href="https://github.com/EanLombardo/eanresume">
                  Project Resume
                </a></div>
                Google AppEngine, Polymer, Google Cloud Endpoints, Google Analytics, Chrome Dev Editor, Google Domains, Google Cloud Datastore
              </div>
              <div class="experienceContent printonly">
                <p>Project resume is an online version of this resume designed to automatically customize itself for the user visiting the page. For more information about project resume see <a href="http://eanlom.info?a={{accessKeyHolder.accessKey}}">http://eanlom.info?a={{accessKeyHolder.accessKey}}</a></p>
              </div>
              <div class="experienceContent noprint">
                <p>This page is part of projecet resume. It was designed as an online resume that automatically customizes itself for the user visiting the page. For more information about project resume click the information button on this page.</p>
              </div>
            </div>
        </section>
      </section>
      <section id="projectResumeSection" class="sectionPage">
      <div id="projectResumeInfo">
        <p><a href="https://github.com/EanLombardo/eanresume"><strong>Project Resume</strong></a></p>

<p>Project Resume is designed to address the flaws in paper resumes or resumes as a share-able documents. The application was built from the ground up in 8 days and uses modern design principals in both the application and user experience design, with the latest technologies.</p>

<p><strong>The problems with paper resumes</strong></p>

<ul>
	<li>
	<p>Sharing a piece of paper is cumbersome:</p>

	<ul>
		<li>
		<p>You either have to scan and email it, or copy it and physically pass it around.</p>
		</li>
	</ul>
	</li>
	<li>
	<p>Manually customizing resumes is tedious:</p>

	<ul>
		<li>
		<p>Building multiple customized resumes for potential employers is very time consuming.</p>
		</li>
		<li>
		<p>Managing multiple versions of resumes is difficult and prone to errors that can mean the loss of a potential job opportunity.</p>
		</li>
		<li>
		<p>This is also true of resumes as a share-able document.</p>
		</li>
	</ul>
	</li>
	<li>
	<p>Paper resumes expire:</p>

	<ul>
		<li>
		<p>When a potential employer holds on to a resume for any period of time the resume can quickly become out of date. This can result in potential employers being unaware of important new skills and experiences you have acquired.</p>
		</li>
	</ul>
	</li>
	<li>
	<p>Paper resumes don&rsquo;t utilize your technical skills:</p>

	<ul>
		<li>
		<p>A simple piece of paper can never interact with a potential employer the way an online resume will engage the viewer and promote the skills of a tech savvy job seeker.</p>
		</li>
		<li>
		<p>This is also true of resumes as a share-able document</p>
		</li>
	</ul>
	</li>
</ul>

<p><strong>The Goal</strong></p>

<p>The first goal of Project Resume is meant to address all of the problems with paper resumes. It allows resumes to be easily customized by manipulating data objects in the Datastore. The application then uses these objects to automatically customize itself. Every time the page is visited, the information shown is always up to date. This means a potential employer will never view an out of date resume</p>

<p>The second goal of Project Resume is to endorse my development skills. By looking at the application itself, or even <a href="https://github.com/EanLombardo/eanresume">through the code</a>, a potential employer can immediately see how I handle my trade, even before speaking with me.

<p>Project Resume was not only my first Go project, but also my first project using Polymer, and AppEngine.</p>

<p><strong>The Frontend</strong></p>

<p>The frontend, which you are using right now, was built using a Polymer, html5, css3, and Javascript. The frontend comunnicates with an AppEngine application over a CloudEndpoints based REST service to automatically load the resume&rsquo;s data from the Resume Services based off of the accessKey given when the front end first loads. The accessKey can be given as a URL parameter, or entered when the front end loads. The frontend also uses Google Analytics to track who visits the page, what resume version is loaded, and user interaction.</p>

<p><strong>The Backend</strong></p>

<p>The backend is several CloudEndpoints based REST Apis written in Go. Data objects are stored in Cloud Datastore with an access control list that defines whether or not each item should be shown to a viewer with a specific access key. The service then filters out all of the requested data items and exposes them to the client while stripping the access control list so that the client can&rsquo;t see other parties accessKeys.</p>

<p>Designing the application in this way allows the resume to automatically customize itself based on the accessKey provided by hiding objects, and then showing different versions of objects based on the access control list. As a result of this design decision, I now have my very own public REST api for my resume. <a href="http://eanresume.appspot.com/_ah/api/explorer">Explore my API</a></p>

<p><strong>UX Design</strong></p>

<p>I am not a User Experience designer. However, I know that a delightful user experience is important in any application. That is why Polymer was chosen for the interface, Polymer makes designing an interface that fits the Material Design language very easy. All I had to do is build a easily browse-able page and follow the Material Design guidelines and Polymer would give me a great user experience. Also Material Design allows the potential employer the feel of paper, without all of the problems of paper resumes.</p>

      </div>
      </section>
      </core-animated-pages>
    </core-scroll-header-panel>
  </template>
  <script>

  var apis = ['experiences','achievements','languages','introductions','projects','references','technologies','documents'];
  var polymerReady = false;
  var gapiReady = false;

    Polymer('eans-resume', {
      ready: function ()
      {
        CoreStyle.g.paperInput.focusedColor = "#4285F4";
        polymerReady = true;
        trueReady();
        this.ga = ga;
        this.today = new Date().toLocaleDateString();
      },
      share: function(event)
      {
        this.$.shareDialog.toggle();
        ga('send', 'event', 'Share', element.accessKeyHolder.accessKey);
      },
      maxLoad : apis.length,
      customText: "Loading public resume",
      totalLoaded: 0,
      page:0,
      sharePrivate: false,
      today :'',
      ga : function(){},
      emailEan : function(event)
      {
        document.location.href = "mailto:el3h6@mst.edu";
      },
      copy: function(event)
      {
        if (document.selection) {
            var range = document.body.createTextRange();
            range.moveToElementText(event.target);
            range.select();
        } else if (window.getSelection) {
            var range = document.createRange();
            range.selectNode(event.target);
            window.getSelection().addRange(range);
        }
      },
      showProjectResume : function(event)
      {
        this.page = 2;
        ga('send', 'event', 'ShowProjectResume', element.accessKeyHolder.accessKey);
      },
      print: function(event)
      {
        var printFrame = this.shadowRoot.querySelector("#printFrame");
        var printWindow = printFrame.contentWindow;
        if(printWindow)
        {
          //This is a clever way of bypassing polymer's printing issues
          var html = this.$.primarySection.innerHTML;
          printWindow.document.head.innerHTML = '<link rel="stylesheet" type="text/css" href="http://eanlom.info/print.css">';
          printWindow.document.body.innerHTML = html;
          //This is a really really poor way to wait for the stylesheet above to finish loading
          window.setTimeout(function(){printWindow.print();},3000);
          ga('send', 'event', 'Share', element.accessKeyHolder.accessKey);
        }
      },
      backToResume: function(event)
      {
        this.page = 1;
      },
      accessKeyHolder: {accessKey : ""},
      customize: function(event)
      {
        var element = this;
        if(this.accessKeyHolder.accessKey == "")
        {
          this.accessKeyHolder.accessKey = "nokey";

          for(var i =0;i<apis.length;i++)
          {
            loadItemsFromApi(apis[i],element.accessKeyHolder)
          }
        }
        else
        {
           gapi.client.accesskeys.get(element.accessKeyHolder).execute(function (resp){
             if(resp.accessKey == element.accessKeyHolder.accessKey)
             {
                if(element.accessKeyHolder.accessKey != "nokey")
                {
                  element.customText = "Customizing resume for " + resp.Owner;
                }
                for(var i =0;i<apis.length;i++)
                {
                  loadItemsFromApi(apis[i],element.accessKeyHolder)
                }
             }
             else
             {
               element.$.accessDialog.toggle();
               element.$.accessKeyToast.show();
             }
           });
        }
      }
    });

    function trueReady()
    {
      if(polymerReady && gapiReady)
      {
        var element = document.querySelector('eans-resume');
        var tempaccessKey = getURLParameter("a");

        if(tempaccessKey == null)
        {
          element.$.accessDialog.toggle();
        }
        else
        {
          gapi.client.accesskeys.get({accessKey : tempaccessKey }).execute(function (resp){
            if(resp.accessKey == tempaccessKey)
            {
              element.accessKeyHolder.accessKey = tempaccessKey;
              element.customize(null);
            }
            else
            {
              element.$.accessDialog.toggle();
            }
          });
        }
      }
    }

    function registerSingleLoadDone()
    {
      var element = document.querySelector('eans-resume');
      element.totalLoaded = element.totalLoaded + 1;

      if(element.totalLoaded == element.maxLoad)
      {
        //AppEngine is too fast, put a delay in displaying the resume so the user can see the message
        window.setTimeout(function(){element.page=1;},1000);
        window.setTimeout(function(){element.$.primaryPages.transitions = "slide-from-right"},300);
        ga('send', 'event', 'ResumeLoad', element.accessKeyHolder.accessKey);
      }
    }
    function loadItemsFromApi(apiName,accessKey)
    {
      gapi.client.load(apiName,'v1',function() {
        gapi.client[apiName].list(accessKey).execute(function(res){
          document.querySelector('eans-resume')[apiName] = res.items;
          registerSingleLoadDone();
        });
      },'https://eanresume.appspot.com/_ah/api');
    }

    function afterGapiLoad()
    {
      gapi.client.load('accesskeys','v1',function(){
        gapiReady = true;
        trueReady();
      },'https://eanresume.appspot.com/_ah/api');
    }

    function getURLParameter(name) {
      return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
    }
  </script>
  <script src="https://apis.google.com/js/client.js?onload=afterGapiLoad">
  </script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54329940-1', 'auto');
  ga('send', 'pageview');
  </script>
</polymer-element>