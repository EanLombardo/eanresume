<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-scroll-header-panel/core-scroll-header-panel.html">
<link rel="import" href="../core-icons/social-icons.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../core-animated-pages/core-animated-pages.html">
<link rel="import" href="../core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../paper-progress/paper-progress.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="safe-html.html">
<link rel="import" href="grid-hero-displayer.html">


<polymer-element name="eans-resume">

  <template>
    <style>    
      #core_scroll_header_panel {
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        position: absolute;
      }
      #eanImage{
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: block;
        background-image: url(ean.jpg);
        margin: 2px;
      }
      #eanImageWrapper{
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: block;
        background-color: white;
      }
      #core_toolbar {
        color: rgb(241, 241, 241);
        fill: rgb(241, 241, 241);
        background-color: rgb(66, 133, 244);
      }
      #primarySection {
        height: 5000px;
        background: linear-gradient(rgb(214, 227, 231), rgb(173, 216, 230));
      }
      #projectResumeSection {
        height: 5000px;
        background: linear-gradient(rgb(214, 227, 231), rgb(173, 216, 230));
      }
      .core_card {
        border-top-left-radius: 2px;
        border-top-right-radius: 2px;
        border-bottom-right-radius: 2px;
        border-bottom-left-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        margin: 16px;
        padding: 8px;
        background-color: rgb(255, 255, 255);
      }
      .slideIn {
        
      }
      .sectionHeader
      {
        font-size: xx-large;
        padding:16px 0px 0px 8px;
      }
      a
      {
        text-decoration: none;
      }
      .experienceName
      {
        font-size: large;
        font-weight:bold;
      }
      .experienceName
      {
        font-size: normal;
        font-weight: normal;
      }
      .experienceHeader
      {
        width: 100%;
        text-align: center;
      }
      .experienceContent
      {
        padding: 0px 8px 8px 8px;
      }
      .refName
      {
        float: center;
        text-align: center;
      }
      .refText
      {
        max-width: 200px;
        padding: 8px;
      }
      #loadingWrapper{
        bottom: 0;
        height: 50px;
        left: 0;
        margin: auto;
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        text-align: center;
      }
      #loadingSection
      {
        height:100%;
        width:100%;
      }
      #primaryPages
      {
        height:100%;
        width:100%;
      }
    </style>
    <core-scroll-header-panel id="core_scroll_header_panel">
      <core-toolbar id="core_toolbar" flex>
        <div hidden?="{{page > 1}}" id="eanImageWrapper"><div id="eanImage"></div></div>
        <div hidden?="{{page > 1}}" flex>Ean Lombardo's Resume</div>
        <paper-icon-button hidden?="{{page < 2}}" icon="arrow-back" on-tap="{{backToResume}}"></paper-icon-button>
        <div hidden?="{{page < 2}}" flex>Project Resume</div>
        <paper-icon-button hidden?="{{page > 1}}" icon="info" on-tap="{{showProjectResume}}"></paper-icon-button>
        <paper-icon-button icon="social:share-alt"></paper-icon-button>
      </core-toolbar>
      <core-animated-pages id="primaryPages" selected="{{page}}" transitions="cross-fade-all" content>
      <section id="loadingSection">
      <paper-dialog id="accessDialog" heading="Access Key" transition="paper-dialog-transition-bottom" backdrop="true" autoCloseDisabled="true">
        <paper-input label="Access Key" floatingLabel="true" value="{{accessKeyHolder.AccessKey}}"></paper-input>
        <paper-button label="Ok" affirmative="" on-tap="{{customize}}"></paper-button>
      </paper-dialog>
        <div id="loadingWrapper" cross-fade>
          <div id="loadingTitle">Customizing Resume</div>
          <paper-progress value="{{totalLoaded}}" max="{{maxLoad}}"></paper-progress>
        </div>
      </section>
      <section id="primarySection" vertical layout>
      <section id="introductionSection">
          <template repeat="{{i in introductions}}">
            <core-card class="core_card" vertical layout><safe-html html="{{i.content}}"></safe-html></core-card>
          </template>
       </section>
        <section id="achievementSection">
          <div class="sectionHeader">Achievements</div>
          <template repeat="{{a in achievements}}">
            <core-card class="core_card" vertical layout>{{a.text}}</core-card>
          </template>
        </section>
        <section id="experienceSection">
          <div class="sectionHeader">Experience</div>
          <template id="template" repeat="{{e in experiences}}">
            <core-card class="core_card" vertical layout>
              <div class="experienceHeader">
                <div><a class="experienceName" href="{{e.companyUrl}}">
                  {{e.companyName}}
                </a></div>
                {{e.workPeriod}}
              </div>
              <div class="experienceContent"><safe-html html="{{e.content}}"></safe-html></div>
            </core-card>
          </template>
        </section>
        <section id="referencesSection">
           <div class="sectionHeader">References</div>
           <div id="referencesContainer" horizontal layout wrap around-justified start>
             <template id="template" repeat="{{r in references}}">
                <core-card class="core_card" vertical layout>
                  <div class="refName">{{r.name}}</div>
                  <div class="refPhone"><a href="tel:{r.phone}}">{{r.phone}}</a></div>
                  <div class="refEmail"><a href="tel:{r.email}}">{{r.email}}</a></div>
                  <div class="refText">{{r.text}}</div>
                </core-card>
              </template>
           </div>
        </section>
        <section id="languageSection">
          <div class="sectionHeader">Languages</div>
          <grid-hero-displayer id="languageDisplayer" items="{{languages}}"></grid-hero-displayer>
        </section>
      </section>
      <section id="projectResumeSection">
        blah
      </section>
      </core-animated-pages>
    </core-scroll-header-panel>
  </template>
  <script>
  
  var apis = ['experiences','achievements','languages','introductions','projects','references','technologies'];
  var ready = false;
    function afterGapiLoad()
    {
    Polymer('eans-resume', {
      ready: function ()
      {
        ready = true;
        this.$.accessDialog.toggle('paper-dialog-transition-bottom');
      },
      transitionItem: function(event)
      {
        alert("wrong");
      },
      maxLoad : apis.length,
      totalLoaded: 0,
      page:0,
      showProjectResume : function(event)
      {
        this.page = 2;
      },
      backToResume: function(event)
      {
        this.page = 1;
      },
      accessKeyHolder: {AccessKey : ""},
      customize: function(event)
      {
        if(this.accessKeyHolder.AccessKey == "")
        {
          this.accessKeyHolder.AccessKey = "nokey";
        }
        for(var i =0;i<apis.length;i++)
        {
          loadItemsFromApi(apis[i],this.accessKeyHolder)
        }
      }
    });
    }
    
    function registerSingleLoadDone()
    {
      var element = document.querySelector('eans-resume');
      element.totalLoaded = element.totalLoaded + 1;
      
      if(element.totalLoaded == element.maxLoad)
      {
        element.page=1;
        window.setTimeout(function(){element.$.primaryPages.transitions = "slide-from-right"},300)
      }
    }
    
    function loadItemsFromApi(apiName,accessKey)
    {
      gapi.client.load(apiName,'v1',function() {
        gapi.client[apiName].list(accessKey).execute(function(res){
          setItems(res.items,apiName);
        });
      },'https://eanresume.appspot.com/_ah/api');
    }
    
    function setItems(items,apiName)
    {
      if(!ready)
      {
        window.setTimeout(function(){setItems(items,apiName);},300)
      }
      else
      {
        document.querySelector('eans-resume')[apiName] = items;
        registerSingleLoadDone();
      }
    }
  </script>
    <script src="https://apis.google.com/js/client.js?onload=afterGapiLoad">
  </script>

</polymer-element>